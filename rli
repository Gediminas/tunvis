#!/usr/bin/env bash

#sudo iptables -D OUTPUT  -p ICMP -j LOG --log-prefix "f OUT: "
sudo iptables -A OUTPUT  -p ICMP -j LOG --log-prefix "f OUT: "

#sudo iptables -D INPUT   -p ICMP -j LOG --log-prefix "f INP: "
sudo iptables -A INPUT   -p ICMP -j LOG --log-prefix "f INP: "

#sudo iptables -D FORWARD -p ICMP -j LOG --log-prefix "f FWD: "
sudo iptables -A FORWARD -p ICMP -j LOG --log-prefix "f FWD: "

sudo iptables -t mangle -A OUTPUT      -p ICMP -j LOG --log-prefix "m OUT: "
sudo iptables -t mangle -A INPUT       -p ICMP -j LOG --log-prefix "m INP: "
sudo iptables -t mangle -A FORWARD     -p ICMP -j LOG --log-prefix "m FWD: "
sudo iptables -t mangle -A PREROUTING  -p ICMP -j LOG --log-prefix "m PRE: "
sudo iptables -t mangle -A POSTROUTING -p ICMP -j LOG --log-prefix "m POS: "

sudo iptables -t nat    -A OUTPUT      -p ICMP -j LOG --log-prefix "n OUT: "
sudo iptables -t nat    -A INPUT       -p ICMP -j LOG --log-prefix "n INP: "
sudo iptables -t nat    -A PREROUTING  -p ICMP -j LOG --log-prefix "n PRE: "
sudo iptables -t nat    -A POSTROUTING -p ICMP -j LOG --log-prefix "n POS: "

#m OUT: IN= OUT=enp0s3 SRC=192.168.101.137 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=7355 DF PROTO=ICMP TYPE=8 CODE=0 ID=3032 SEQ=1
#f OUT: IN= OUT=enp0s3 SRC=192.168.101.137 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=7355 DF PROTO=ICMP TYPE=8 CODE=0 ID=3032 SEQ=1
#m POS: IN= OUT=enp0s3 SRC=192.168.101.137 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=7355 DF PROTO=ICMP TYPE=8 CODE=0 ID=3032 SEQ=1
#m PRE: IN=enp0s3 OUT= MAC=08:00:27:6a:09:7a:48:8f:5a:17:58:d9:08:00 SRC=8.8.8.8 DST=192.168.101.137 LEN=84 TOS=0x00 PREC=0x00 TTL=115 ID=0 PROTO=ICMP TYPE=0 CODE=0 ID=3032 SEQ=1
#m INP: IN=enp0s3 OUT= MAC=08:00:27:6a:09:7a:48:8f:5a:17:58:d9:08:00 SRC=8.8.8.8 DST=192.168.101.137 LEN=84 TOS=0x00 PREC=0x00 TTL=115 ID=0 PROTO=ICMP TYPE=0 CODE=0 ID=3032 SEQ=1
#f INP: IN=enp0s3 OUT= MAC=08:00:27:6a:09:7a:48:8f:5a:17:58:d9:08:00 SRC=8.8.8.8 DST=192.168.101.137 LEN=84 TOS=0x00 PREC=0x00 TTL=115 ID=0 PROTO=ICMP TYPE=0 CODE=0 ID=3032 SEQ=1

#m OUT: IN= OUT=tun11 SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1
#f OUT: IN= OUT=tun11 SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1
#m POS: IN= OUT=tun11 SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1
#m PRE: IN=tun12 OUT= MAC= SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=64 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1 MARK=0x2a
#m FWD: IN=tun12 OUT=enp0s3 MAC= SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=63 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1 MARK=0x2a
#f FWD: IN=tun12 OUT=enp0s3 MAC= SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=63 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1 MARK=0x2a
#m POS: IN= OUT=enp0s3 SRC=10.77.11.11 DST=8.8.8.8 LEN=84 TOS=0x00 PREC=0x00 TTL=63 ID=48452 DF PROTO=ICMP TYPE=8 CODE=0 ID=30907 SEQ=1 MARK=0x2a
